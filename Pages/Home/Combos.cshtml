@page "/Combo"
@model PcrBattleChannel.Pages.Home.CombosModel
@{
    ViewData["Title"] = "个人分刀";
}

<h4>个人分刀</h4>
<hr />

<partial name="_Combo_StatusPartial" model="Model" />
<div class="row pt-2 pb-4">
    <div class="col-md-10">
        <form method="post" asp-page-handler="setdraft"
              data-ajax="true" data-ajax-method="post"
              data-ajax-failure="draft_option_update_failure">
            <label class="form-group form-check-label pb-2">
                <input type="checkbox" asp-for="UserIncludesDrafts"
                       onchange="$(this.form).submit()" />
                匹配时包括草稿
            </label>
        </form>
        <form method="post" asp-page-handler="refresh">
            <button type="submit" class="btn btn-primary">重新计算</button>
        </form>
    </div>
</div>

<h4>Boss推荐度</h4>

<div class="row pt-2 pb-4">
    <div class="w-100 border-top"></div>
    @foreach (var (name, value) in Model.BossValues)
    {
        <div class="col-12 col-md-6 col-lg-4 py-2 border-bottom">
            <div class="row">
                <div class="col-6">@name</div>
                <div class="col-6">@value.ToString("P1")</div>
            </div>
        </div>
    }
</div>

<h4>阵容推荐度</h4>
<div class="row align-bottom py-2 border-top border-bottom">
    <div class="col-xl-10 col-lg-9 col-md-8 col-sm-12">
        <span class="font-weight-bold">阵容</span>
    </div>
    <div class="col-xl-2 col-lg-3 col-md-4 d-none d-md-block">
        <span class="d-inline-block font-weight-bold">推荐度</span>
        <span class="d-inline-block font-weight-bold">（当前/初始）</span>
    </div>
</div>
@for (int i = 0; i < Model.UserCombo.Count; ++i)
{
    var group = Model.UserCombo[i];
    <div class="row align-bottom py-2 border-bottom">
        <div class="col-xl-10 col-lg-9 col-8">
            <a href="javascript:void(0)" onclick="$('#toggle-combo-group-@i').toggle()">@group.name (@group.list.Count 个套餐)</a>
        </div>
        <div class="col-xl-2 col-lg-3 col-4">
            <span>@group.value.ToString("P1") / @group.netValue.ToString("P1")</span>
        </div>
    </div>
    <div id="toggle-combo-group-@i" style="display:none">
        @foreach (var item in group.list)
        {
            <div id="combo-@item.UserComboID">
                <partial name="_Combo_ComboPartial" model="Model.CreateSingleModel(item)" />
            </div>
        }
    </div>
}

<style>
    #character-list .character-list-item {
        display: inline-block;
        position: relative;
    }

    #character-list .tick-mark {
        position: absolute;
        right: -3px;
        bottom: -3px;
        width: 25px;
        height: 25px;
        z-index: 1;
        display: none;
    }

        #character-list .tick-mark img {
            width: 100%;
        }

    #character-list .selected .tick-mark {
        display: block;
    }
</style>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.min.js"></script>
    <script>
        function user_status_confirm_success() {
            $('#status-confirm-button').prop('disabled', true);
            $('.guessed').hide();
        }
        function toggle_user_status_edit(btn) {
            btn.form.reset();
            $('#user-status-display').toggle();
            $('#user-status-edit').toggle();
        }
        function user_status_update_failure() {
            alert('更新失败');
        }
        function user_status_edit_character_click(e) {
            $(e).toggleClass('selected');
            var allSelected = $('#character-list .selected');
            var str = '';
            allSelected.each(function (a, b) {
                if (str.length > 0) str = str + ',';
                str = str + b.getAttribute('data-character-id');
            });
            $('#characterliststring').val(str);
        }
        function combo_select_success() {
            var id = this.getAttribute('data-select-combo-toggle');
            $('.select-next-div-selected').hide();
            $('.select-next-div-unselected').show();
            $(id).toggle();
        }
        function combo_select_failure() {
            alert('设置失败');
        }
        function draft_option_update_failure() {
            alert('设置失败');
        }
    </script>
}
